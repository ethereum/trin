# Release checklist

## First

Ensure that the CI for the latest commit to master is passing.
This ensures that trin itself is working, and that the latest docker image is working and published. 

## Communicate

Announce in #trin chat the upcoming release. Aim for a day or more notice, but
announcing a few minutes before releasing is still better than not saying
anything.

## Choosing a version

Make sure that version follows [semver](https://semver.org/) rules e.g (`0.2.0-alpha.3`).

Since trin is now stable, but v0, breaking changes are a minor version bump,
and all other changes are a patch version bump. Updating to v1 would require a
group discussion and decision.

## Release dependencies

For now, that's just ethportal-api, plus the whole workspace. Steps to release:

1. Bump the version in that crate's Cargo.toml (pay attention to whether there are any API changes that require a major version bump)
2. Bump the version in the workspace Cargo.toml
3. Run `cargo update` to update the workspace lockfile
4. Get a review on whether the version number changes are appropriate
5. Merge the combined PR into master
6. Publish the ethportal-api release with:

```bash
cargo publish -p ethportal-api
```

## Release Trin

We use automated github release workflow to create a new release.
This will create a new release draft with the new tag and will build all the binaries and attach them to the release. 

1. Checkout and rebase local master to upstream
```bash
git checkout master
git pull --ff-only upstream master
```
2. Create a new git tag with the chosen version, for example:
```bash
git tag v0.1.0-alpha.15
 ```
3. Push the tag to the upstream repository:
```bash
git push upstream v0.1.0-alpha.15
```
4. Wait for the github actions release job to finish. It will create automatically a draft release with all precompiled binaries included.
This should take 15-20 min to complete.
5. Find the draft release generated by the github bot in releases and edit the template by completing and deleting all checklists.
Write a short summary if available. Add any clarifying information that's helpful about the release.
6. Scroll to the bottom and click `Publish release` (if it's an alpha/beta release, make sure to mark it as pre-release).

### Build Instructions
* [Linux](../build_instructions/linux.md)
* [Mac OS](../build_instructions/mac_os.md)
* [Raspberry Pi](../build_instructions/raspberry_pi.md)
* [Windows](../build_instructions/windows.md)

## Deploy

Push these changes out to the nodes we run in the network. See next page for details.

## Communicate

Notify in Discord chat about the new release being complete.

As trin stabilizes, more notifications will be necessary (twitter, blog post, etc). Though we probably want to do at least a small network deployment before publicizing.
